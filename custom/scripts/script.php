<?php
/**
 * Этот скрипт использует Redis для установки блокировки,
 * чтобы предотвратить одновременное выполнение нескольких экземпляров
 * одного и того же скрипта.
 * Если скрипт уже выполняется, новый запуск будет запрещен.
 *
 * @author Ksenia Ziman
 */

// Подключение к Redis
$redis = new Redis();
$redis->connect('127.0.0.1', 6379);

// Ключ для блокировки
$lockKey = 'script_lock';
$lockTimeout = 10;

// Проверяем, есть ли блокировка
if ($redis->exists($lockKey)) {
    echo "Скрипт уже выполняется. Повторный запуск запрещен.\n";
    exit;
}

// Устанавливаем блокировку
$redis->set($lockKey, 1, $lockTimeout);

// Выполнение скрипта
echo "Скрипт запущен. Выполнение...\n";
sleep(5);

// Удаляем блокировку
$redis->del($lockKey);
echo "Скрипт завершен.\n";
